<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="../css/styles.css"/>
  <link rel="stylesheet" href="../css/formulario.css"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pago | High Cloud 8</title>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9f9f9;
      color: #333;
    }

    nav.navbar {
      display: none !important;
    }

    h2, h3 {
      color: #1a54dd;
      font-weight: 700;
      text-align: center;
    }

    .pricing-img {
      width: 600px;
      max-width: 100%;
      margin: 1.5rem 0;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(26, 84, 221, 0.1);
    }

    #paypal-deposito,
    #paypal-suscripcion {
      margin-bottom: 2rem;
      transition: opacity 0.4s ease;
    }

    /* Visualmente desactivado pero aún funcional */
    #paypal-suscripcion.not-ready {
      opacity: 0.3;
    }

    #submitBtn {
      display: block;
      width: 100%;
      max-width: 320px;
      padding: 1rem 2rem;
      margin-top: 2rem;
      background-color: #1a54dd;
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: not-allowed;
      transition: background-color 0.3s ease, transform 0.3s ease;
      box-shadow: 0 8px 20px rgba(26, 84, 221, 0.3);
    }

    #submitBtn.enabled {
      cursor: pointer;
      background-color: #0041a8;
      box-shadow: 0 12px 24px rgba(0, 65, 168, 0.4);
    }

    #submitBtn.enabled:hover {
      background-color: #003080;
      transform: scale(1.05);
    }
  </style>
</head>
<body>

  <h2>Pago obligatorio</h2>
  <p>Debe completar ambos pagos para continuar.</p>

  <img src="../img/HighCloud8Prices.png" alt="Precios" class="pricing-img" />

  <h3>1. Depósito inicial ($199)</h3>
  <div id="paypal-deposito"></div>

  <h3>2. Suscripción mensual ($119/mes)</h3>
  <div id="paypal-suscripcion" class="not-ready"></div>

  <button id="submitBtn" disabled aria-disabled="true">Enviar Formulario</button>

  <!-- PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AXEcXn7TJDcigKv90GQ_PFH4ZPO_a1lX8okIkuVx8SLhe4hZ2e6A6guHxeVDJELrV_dKMhovIl-WP60A&vault=true&intent=subscription&currency=USD"></script>

  <script>
    const submitBtn = document.getElementById('submitBtn');
    const paypalSuscripcion = document.getElementById('paypal-suscripcion');

    let depositoPagado = false;
    let suscripcionPagada = false;

    // Botón depósito
    paypal.Buttons({
      style: {
        shape: 'pill',
        color: 'blue',
        layout: 'vertical',
        label: 'pay',
      },
      createOrder: function (data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: { value: '199.00' }
          }]
        });
      },
      onApprove: function (data, actions) {
        return actions.order.capture().then(function (details) {
          alert('Depósito pagado por: ' + details.payer.name.given_name);
          depositoPagado = true;
          paypalSuscripcion.classList.remove('not-ready');
        });
      }
    }).render('#paypal-deposito');

    // Botón suscripción
    paypal.Buttons({
      style: {
        shape: 'rect',
        color: 'gold',
        layout: 'vertical',
        label: 'subscribe',
      },
      onInit: function(data, actions) {
        actions.disable(); // inicialmente desactivado
        const interval = setInterval(() => {
          if (depositoPagado) {
            actions.enable();
            clearInterval(interval);
          }
        }, 300);
      },
      createSubscription: function (data, actions) {
        return actions.subscription.create({
          plan_id: 'P-7GG71663VP171750UNBGVNNQ'
        });
      },
      onApprove: function (data, actions) {
        alert('¡Suscripción activada! ID: ' + data.subscriptionID);
        suscripcionPagada = true;
        if (depositoPagado && suscripcionPagada) {
          submitBtn.disabled = false;
          submitBtn.setAttribute('aria-disabled', 'false');
          submitBtn.classList.add('enabled');
        }
      }
    }).render('#paypal-suscripcion');

    // Botón de envío
    submitBtn.addEventListener('click', function () {
      if (depositoPagado && suscripcionPagada) {
        alert('Formulario enviado. ¡Gracias por tu pago!');
        // Aquí puedes hacer redirección o envío de datos
        // window.location.href = 'gracias.html';
      } else {
        alert('Debes completar ambos pagos antes de continuar.');
      }
    });
  </script>
</body>
</html>
